import pandas as pd
import folium
import re

# ì œê³µëœ SQL ë°ì´í„°
sql_data = """
(4719000000, 'êµ¬ë¯¸ì‹œ', 4700000000, ST_GeomFromText('POINT(128.362699 36.212292)')),
(4719025000, 'ì„ ì‚°ì', 4719000000, ST_GeomFromText('POINT(128.283580 36.246959)')),
(4719025300, 'ê³ ì•„ì', 4719000000, ST_GeomFromText('POINT(128.327688 36.183645)')),
(4719025600, 'ì‚°ë™ì', 4719000000, ST_GeomFromText('POINT(128.462296 36.181061)')),
(4719031000, 'ë¬´ì„ë©´', 4719000000, ST_GeomFromText('POINT(128.187926 36.265641)')),
(4719032000, 'ì˜¥ì„±ë©´', 4719000000, ST_GeomFromText('POINT(128.265567 36.304640)')),
(4719033000, 'ë„ê°œë©´', 4719000000, ST_GeomFromText('POINT(128.353137 36.304457)')),
(4719034000, 'í•´í‰ë©´', 4719000000, ST_GeomFromText('POINT(128.408992 36.219688)')),
(4719035000, 'ì‚°ë™ë©´', 4719000000, ST_GeomFromText('POINT(128.462201 36.181115)')),
(4719036000, 'ì¥ì²œë©´', 4719000000, ST_GeomFromText('POINT(128.511828 36.150167)')),
(4719051000, 'ì†¡ì •ë™', 4719000000, ST_GeomFromText('POINT(128.353882 36.121199)')),
(4719052000, 'ì›í‰1ë™', 4719000000, ST_GeomFromText('POINT(128.353304 36.128466)')),
(4719053000, 'ì›í‰2ë™', 4719000000, ST_GeomFromText('POINT(128.339042 36.134351)')),
(4719053500, 'ì›í‰ë™', 4719000000, ST_GeomFromText('POINT(128.347429 36.130805)')),
(4719055100, 'ë„ëŸ‰ë™', 4719000000, ST_GeomFromText('POINT(128.337561 36.145738)')),
(4719055500, 'ì§€ì‚°ë™', 4719000000, ST_GeomFromText('POINT(128.357704 36.139665)')),
(4719056500, 'ì„ ì£¼ì›ë‚¨ë™', 4719000000, ST_GeomFromText('POINT(128.319947 36.131881)')),
(4719058200, 'í˜•ê³¡1ë™', 4719000000, ST_GeomFromText('POINT(128.336033 36.118847)')),
(4719058300, 'í˜•ê³¡2ë™', 4719000000, ST_GeomFromText('POINT(128.336888 36.107089)')),
(4719059000, 'ì‹ í‰1ë™', 4719000000, ST_GeomFromText('POINT(128.362825 36.121911)')),
(4719060000, 'ì‹ í‰2ë™', 4719000000, ST_GeomFromText('POINT(128.366608 36.127303)')),
(4719061000, 'ë¹„ì‚°ë™', 4719000000, ST_GeomFromText('POINT(128.377883 36.125332)')),
(4719062100, 'ê³µë‹¨1ë™', 4719000000, ST_GeomFromText('POINT(128.378103 36.120561)')),
(4719062200, 'ê³µë‹¨2ë™', 4719000000, ST_GeomFromText('POINT(128.378167 36.096145)')),
(4719063000, 'ê´‘í‰ë™', 4719000000, ST_GeomFromText('POINT(128.360467 36.108405)')),
(4719064500, 'ìƒëª¨ì‚¬ê³¡ë™', 4719000000, ST_GeomFromText('POINT(128.352855 36.094567)')),
(4719066000, 'ì„ì˜¤ë™', 4719000000, ST_GeomFromText('POINT(128.366007 36.078246)')),
(4719067000, 'ì¸ë™ë™', 4719000000, ST_GeomFromText('POINT(128.454495 36.102718)')),
(4719068000, 'ì§„ë¯¸ë™', 4719000000, ST_GeomFromText('POINT(128.410431 36.109180)')),
(4719069000, 'ì–‘í¬ë™', 4719000000, ST_GeomFromText('POINT(128.413260 36.140688)')),
(4719070000, 'ê³µë‹¨ë™', 4719000000, ST_GeomFromText('POINT(128.410274 36.168089)'));
"""

# ğŸ’¡ [ìˆ˜ì •ëœ ë¶€ë¶„] ë” ì•ˆì •ì ì¸ ë°ì´í„° ì¶”ì¶œ ë¡œì§
data = []
# ê° ì¤„ì—ì„œ 'ì´ë¦„'ê³¼ 'ê²½ë„ ìœ„ë„'ë¥¼ í•œ ë²ˆì— ì°¾ëŠ” ì •ê·œì‹ íŒ¨í„´
pattern = re.compile(r"'\s*([^']+)\s*'.*?POINT\(\s*([0-9\.]+)\s+([0-9\.]+)\s*\)")

for line in sql_data.strip().split('\n'):
    # ê° ì¤„ì—ì„œ íŒ¨í„´ì— ë§ëŠ” ë¶€ë¶„ì„ ê²€ìƒ‰
    match = pattern.search(line)
    
    # íŒ¨í„´ì— ë§ëŠ” ë¶€ë¶„ì´ ìˆëŠ” ê²½ìš°ì—ë§Œ ë°ì´í„° ì¶”ì¶œ
    if match:
        name = match.group(1)      # ì²« ë²ˆì§¸ ê´„í˜¸ ê·¸ë£¹ (ì´ë¦„)
        lon = float(match.group(2))  # ë‘ ë²ˆì§¸ ê´„í˜¸ ê·¸ë£¹ (ê²½ë„)
        lat = float(match.group(3))  # ì„¸ ë²ˆì§¸ ê´„í˜¸ ê·¸ë£¹ (ìœ„ë„)
        data.append([name, lat, lon])
# ğŸ’¡ [ìˆ˜ì • ë]

# ë°ì´í„°í”„ë ˆì„ ìƒì„±
df = pd.DataFrame(data, columns=['Name', 'Latitude', 'Longitude'])

# êµ¬ë¯¸ì‹œ ì¤‘ì‹¬ ì¢Œí‘œ
gumi_center = [36.14, 128.36]

# ì§€ë„ ìƒì„±
m = folium.Map(location=gumi_center, zoom_start=11)

# ë§ˆì»¤ ì¶”ê°€
for idx, row in df.iterrows():
    folium.Marker(
        location=[row['Latitude'], row['Longitude']],
        popup=row['Name'],
        tooltip=row['Name']
    ).add_to(m)

# ì§€ë„ ì €ì¥ (ì„±ê³µ ë©”ì‹œì§€ ì¶”ê°€)
try:
    m.save('gumi_map.html')
    print("âœ… ì§€ë„ ìƒì„± ì™„ë£Œ! 'gumi_map.html' íŒŒì¼ì„ í™•ì¸í•˜ì„¸ìš”.")
except Exception as e:
    print(f"âŒ ì§€ë„ ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}")